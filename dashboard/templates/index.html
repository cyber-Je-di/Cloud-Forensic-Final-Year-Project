<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tenant Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
  <div class="dashboard-container">

    <header>
      <h1>ðŸ“Š Forensic Dashboard - {{ selected_tenant }}</h1>
      <div class="controls">
        <a href="{{ url_for('logout') }}" class="btn logout">Logout</a>
      </div>
    </header>

    <form method="POST" class="search-form" style="margin: 20px 0;">
      <input type="text" name="query" placeholder="Search logs..." value="{{ query or '' }}">
      <button type="submit">Search</button>
    </form>

    <section class="log-section">
      <h2>Recent Log Events</h2>
      {% if logs %}
      <table class="alerts-table">
        <thead>
          <tr>
            <th>File</th>
            <th>Line #</th>
            <th>Tenant</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs[:50] %}
          <tr>
            <td>{{ log.file }}</td>
            <td>{{ log.line_num }}</td>
            <td>{{ log.tenant }}</td>
            <td>{{ log.content }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <div class="empty-state">
          <p>No logs found for your query.</p>
        </div>
      {% endif %}
    </section>

    <section class="alerts-section">
      <h2>ðŸš¨ Alert Summary</h2>
      {% if alerts %}
      <table class="alerts-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Tenant</th>
            <th>File</th>
            <th>Line</th>
            <th>Threat</th>
            <th>Pattern</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          {% for alert in alerts %}
          <tr>
            <td>{{ alert.timestamp }}</td>
            <td>{{ alert.tenant }}</td>
            <td>{{ alert.file }}</td>
            <td>{{ alert.line_number }}</td>
            <td>
              <span class="tag threat-{{ alert.threat_type|lower|replace(' ', '-') }}">
                {{ alert.threat_type }}
              </span>
            </td>
            <td>{{ alert.pattern_matched }}</td>
            <td>{{ alert.content }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <div class="empty-state">
          <p>No alerts detected for this tenant.</p>
        </div>
      {% endif %}
    </section>

    <div class="footer-info">
      <form method="POST" action="{{ url_for('export_logs') }}">
        <input type="hidden" name="query" value="{{ query or '' }}">
        <button type="submit" class="btn">Export Logs</button>
      </form>
    </div>

  </div>
</body>
</html>
