<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Tenant Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="dashboard-container">

    <header>
      <h1>ðŸ“Š Forensic Dashboard - {{ selected_tenant }}</h1>
      <div class="controls">
        <a href="{{ url_for('logout') }}" class="btn logout">Logout</a>
      </div>
    </header>

    <form method="POST" class="search-form" style="margin: 20px 0;">
      <input type="text" name="query" placeholder="Search logs..." value="{{ query or '' }}">
      <button type="submit">Search</button>
    </form>

    <section class="log-section">
      <h2>Recent Log Events by Tenant</h2>
      {% for tenant, logs in all_logs.items() %}
      <h3>{{ tenant }}</h3>
      {% if logs %}
      <table class="alerts-table">
        <thead>
          <tr>
            <th>File</th>
            <th>Line #</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs[:50] %}
          <tr>
            <td>{{ log.file }}</td>
            <td>{{ log.line_num }}</td>
            <td>{{ log.content }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="empty-state">
        <p>No logs found for {{ tenant }}.</p>
      </div>
      {% endif %}
      {% endfor %}
    </section>

    <div class="footer-info">
      <form method="POST" action="{{ url_for('export_logs') }}">
        <input type="hidden" name="query" value="{{ query or '' }}">
        <button type="submit" class="btn">Export Logs</button>
      </form>
    </div>

  </div>

  <section>
    <h2>ðŸ“ˆ Alert Statistics</h2>
    <canvas id="threatChart" width="600" height="300"></canvas>
  </section>

  <section>
    <h2>ðŸ“Š Logs Per Tenant</h2>
    <canvas id="logsPerTenantChart" width="600" height="300"></canvas>
  </section>

</body>
<script src="../static/js/script.js"></script>
</html>